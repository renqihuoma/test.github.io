<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>跳转中</title>
</head>
<body>
    <div id="status">正在获取跳转地址...</div>
    <button id="retryBtn" style="display: none;" onclick="fetchAndRedirect()">重试</button>

    <script>
        // 核心配置（已适配接口返回格式：data.subCodeUrl）
        const API_CONFIG = {
            url: 'https://api.rqhm100.cc/link/kjladj',
            urlField: 'data.subCodeUrl', // 接口返回的跳转地址字段（多层嵌套）
            timeout: 8000,
            fallbackUrl: 'https://www.baidu.com'
        };

        let isRequesting = false;

        // 提取嵌套JSON字段的工具函数
        function getNestedValue(data, fieldPath) {
            return fieldPath.split('.').reduce((obj, key) => {
                return obj && obj[key] ? obj[key] : '';
            }, data);
        }

        async function fetchAndRedirect() {
            const statusEl = document.getElementById('status');
            const retryBtn = document.getElementById('retryBtn');

            if (isRequesting) return;
            isRequesting = true;

            statusEl.textContent = '正在获取跳转地址...';
            retryBtn.style.display = 'none';

            try {
                // 超时控制
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), API_CONFIG.timeout);

                // 原生fetch请求
                const response = await fetch(API_CONFIG.url, {
                    method: 'GET',
                    mode: 'cors',
                    credentials: 'omit',
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                // 状态码校验
                if (!response.ok) throw new Error(`状态码：${response.status}`);

                // 解析JSON
                const resData = await response.json();

                console.log(resData.data.subCodeUrl);
                 
                window.location.href = resData.data.subCodeUrl;
                // 执行跳转
                statusEl.textContent = '正在跳转...';
                //setTimeout(() => , 300);

            } catch (error) {
                console.error('跳转异常:', error);
                statusEl.textContent = `跳转失败：${error.message}`;
                retryBtn.style.display = 'inline';

            } finally {
                isRequesting = false;
            }
        }

        // DOM就绪后执行
        window.addEventListener('DOMContentLoaded', fetchAndRedirect);
    </script>
</body>
</html>
